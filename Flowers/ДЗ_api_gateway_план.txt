–ü–ª–∞–Ω –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–¥–∞

–°–æ–∑–¥–∞—Ç—å –°–µ—Ä–≤–∏—Å –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏: –¥–æ–±–∞–≤–∏—Ç—å –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ ASP.NET Web.API:

POST /register - –ø—Ä–∏–Ω—è—Ç–∏–µ –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è, —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ BCrypt), —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É auth_users (user_id, login, password_hash).

POST /login - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è JWT-—Ç–æ–∫–µ–Ω–∞. –í —Ç–æ–∫–µ–Ω –Ω—É–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å user_id –∏ username.

–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å Flowers API:

–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∑–∞–≥–æ–ª–æ–≤–∫–∞ Authorization –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é JWT-—Ç–æ–∫–µ–Ω–∞ —Å –ø–æ–º–æ—â—å—é –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ middleware.

–ò–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É –º–µ—Ç–æ–¥–æ–≤ GET /user/{id} –∏ PUT /user/{id}: —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å user_id –∏–∑ —Ç–æ–∫–µ–Ω–∞ —Å id –∏–∑ URL. –ï—Å–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å 403 Forbidden.

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Kong: –ù–∞–ø–∏—Å–∞—Ç—å KongIngress –∏–ª–∏ KongPlugin –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã:

/auth -> –Ω–∞ —Å–µ—Ä–≤–∏—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

/api -> –Ω–∞ flowers-api.

–¢–µ—Å—Ç—ã Postman
–ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –Ω–∞–±–æ—Ä–∞:

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

baseUrl: http://arch.homework

user1_token, user2_token

user1_id, user2_id

randomUsername, randomEmail (–≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ pm.variables.set('randomUsername', 'user_' + Math.floor(Math.random() * 10000)); –≤ Pre-request Script)

–°—Ü–µ–Ω–∞—Ä–∏–π:

Register User 1 (POST {{baseUrl}}/auth/register, body: {"username": "{{randomUsername}}", "password": "pass123", "email": "{{randomEmail}}"})

Login User 1 (POST {{baseUrl}}/auth/login, body: {"username": "{{randomUsername}}", "password": "pass123"}). –í Tests —Å–∫—Ä–∏–ø—Ç–µ: pm.variables.set('user1_token', pm.response.json().token);

Get Profile WITHOUT token -> 401 (GET {{baseUrl}}/api/user/profile, –±–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ -> –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 401)

Get Profile WITH token -> 200 (GET {{baseUrl}}/api/user/profile, —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º Authorization: Bearer {{user1_token}} -> 200)

Update Profile (PUT {{baseUrl}}/api/user/profile, —Å —Ç–æ–∫–µ–Ω–æ–º, body: {"firstName": "NewName"})

Register and Login User 2 (–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ —à–∞–≥–∞–º 1 –∏ 2, —Ç–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ user2_token)

User2 tries to get User1 profile -> 403 (GET {{baseUrl}}/api/user/{{user1_id}}, —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º Authorization: Bearer {{user2_token}} -> 403 Forbidden)

–ó–∞–ø—É—Å–∫ –∏–∑ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏: newman run your-collection.json --global-var "baseUrl=http://arch.homework" -r cli

=============================================================================================

–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —à–∞–≥–æ–≤ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Kong:

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã –∫ –≤–∞—à–µ–º—É API - –Ω–∞–ø—Ä–∞–≤–∏—Ç—å —Ç—Ä–∞—Ñ–∏–∫ —á–µ—Ä–µ–∑ Kong –Ω–∞ –≤–∞—à flowers-api

–î–æ–±–∞–≤–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é - –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å JWT –ø–ª–∞–≥–∏–Ω –¥–ª—è –∑–∞—â–∏—Ç—ã API

–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–∏ - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ª–æ–≥–∏–Ω, –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–æ—Ñ–∏–ª—é

üîß –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. –°–æ–∑–¥–∞—Ç—å Ingress –¥–ª—è –≤–∞—à–µ–≥–æ API
–ó–∞–º–µ–Ω–∏—Ç–µ kong-test-route –Ω–∞ –º–∞—Ä—à—Ä—É—Ç –∫ –≤–∞—à–µ–º—É —Å–µ—Ä–≤–∏—Å—É:

yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: flowers-api-route
  namespace: default  # –∏–ª–∏ –≥–¥–µ —É –≤–∞—Å —Ä–∞–±–æ—Ç–∞–µ—Ç flowers-api
  annotations:
    konghq.com/strip-path: "true"
spec:
  ingressClassName: kong
  rules:
  - http:
      paths:
      - path: /api
        pathType: Prefix
        backend:
          service:
            name: flowers-api-service  # –∏–º—è –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
            port:
              number: 80  # –ø–æ—Ä—Ç –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
–î–æ–±–∞–≤—å—Ç–µ –ø–ª–∞–≥–∏–Ω –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:

yaml
apiVersion: configuration.konghq.com/v1
kind: KongPlugin
metadata:
  name: jwt-auth
  namespace: default
plugin: jwt
3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–∞–±–æ—Ç—É —á–µ—Ä–µ–∑:

Port-forward: http://localhost:8080/api/user

–ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø: http://localhost:32057/api/user

‚úÖ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:
Kong —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ

Port-forward –Ω–∞—Å—Ç—Ä–æ–µ–Ω ‚úÖ

–ë–∞–∑–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç —Å–æ–∑–¥–∞–Ω ‚úÖ

–ì–æ—Ç–æ–≤ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ ‚úÖ

–ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ Flowers API! üöÄ